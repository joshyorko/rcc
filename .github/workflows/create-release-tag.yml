name: Create Release Tag
on:
    workflow_dispatch:

jobs:
    tag-and-release:
        runs-on: ubuntu-latest
        permissions:
            contents: write
            actions: write
        steps:
            - uses: actions/checkout@v6.0.0
              with:
                  fetch-depth: 0

            - name: Read Version
              id: get_version
              run: |
                  VERSION=$(grep 'Version =' common/version.go | cut -d '`' -f 2)
                  echo "version=$VERSION" >> $GITHUB_OUTPUT
                  echo "Detected version: $VERSION"

            - name: Trigger RCC Release Workflow
              uses: actions/github-script@v8.0.0
              with:
                  script: |
                      await github.rest.actions.createWorkflowDispatch({
                          owner: context.repo.owner,
                          repo: context.repo.repo,
                          workflow_id: 'rcc.yaml',
                          ref: 'main',
                          inputs: {
                              tag: '${{ steps.get_version.outputs.version }}'
                          }
                      });
